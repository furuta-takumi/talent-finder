<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾å“¡æ¤œç´¢ | Talent Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="theme.js"></script>
    <script src="data.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-secondary-50 text-secondary-800 min-h-screen flex flex-col">

    <header class="bg-white/80 backdrop-blur-md border-b border-secondary-200 sticky top-0 z-50 h-16 flex items-center px-6 justify-between shadow-sm">
        <div class="flex items-center gap-3 cursor-pointer group" onclick="resetFilter()">
            <div class="bg-primary-600 text-white p-1.5 rounded-lg shadow-lg shadow-primary-200 group-hover:scale-110 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
            </div>
            <h1 class="font-bold text-lg text-secondary-800 tracking-tight">Talent Finder</h1>
        </div>
        <div class="flex items-center gap-4">
            <a href="mypage_edit.html" class="flex items-center gap-2 hover:bg-secondary-100 px-3 py-1.5 rounded-full transition">
                <span class="text-sm font-medium text-secondary-600 hidden sm:block">ãƒã‚¤ãƒšãƒ¼ã‚¸</span>
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=MyIcon" class="rounded-full w-8 h-8 border border-secondary-200 shadow-sm">
            </a>
        </div>
    </header>

    <div class="flex-1 max-w-7xl mx-auto w-full p-4 lg:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <aside class="lg:col-span-3 space-y-6">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-secondary-100 sticky top-24">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-sm font-bold text-secondary-400 uppercase tracking-wider">Filters</h2>
                    <button onclick="resetFilter()" class="text-xs font-semibold text-primary-600 hover:text-primary-800 hover:bg-primary-50 px-2 py-1 rounded transition">ã‚¯ãƒªã‚¢</button>
                </div>
                
                <div class="space-y-5">
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢..." 
                            class="w-full bg-secondary-50 border border-secondary-200 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 outline-none transition shadow-sm">
                        <div class="absolute right-3 top-3 text-secondary-400">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </div>
                    </div>
                    <div class="border-t border-secondary-100 my-2"></div>
                    <div class="space-y-4">
                        <div>
                            <label class="text-xs font-bold text-secondary-500 block mb-1.5 ml-1">æ‰€å±éƒ¨ç½²</label>
                            <select id="filter-dept" class="w-full border border-secondary-200 rounded-xl px-3 py-2.5 text-sm bg-white hover:border-primary-300 focus:ring-2 focus:ring-primary-500 outline-none cursor-pointer transition"><option value="">å…¨ã¦ã®éƒ¨ç½²</option></select>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-secondary-500 block mb-1.5 ml-1">å…¥ç¤¾å¹´åº¦</label>
                            <select id="filter-year" class="w-full border border-secondary-200 rounded-xl px-3 py-2.5 text-sm bg-white hover:border-primary-300 focus:ring-2 focus:ring-primary-500 outline-none cursor-pointer transition"><option value="">å…¨ã¦ã®å¹´åº¦</option></select>
                        </div>
                    </div>
                    <div class="border-t border-secondary-100 my-2"></div>
                    <div class="space-y-4">
                        <div>
                            <label class="text-xs font-bold text-primary-500 block mb-1.5 ml-1 flex items-center gap-1"><span class="bg-primary-100 p-1 rounded-md">ğŸ’»</span> å¾—æ„ã‚¹ã‚­ãƒ«</label>
                            <select id="filter-skill" class="w-full border border-primary-100 rounded-xl px-3 py-2.5 text-sm bg-primary-50/30 hover:border-primary-300 focus:ring-2 focus:ring-primary-500 outline-none cursor-pointer transition"><option value="">æŒ‡å®šãªã—</option></select>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-accent-500 block mb-1.5 ml-1 flex items-center gap-1"><span class="bg-accent-100 p-1 rounded-md">ğŸ…</span> ä¿æœ‰è³‡æ ¼</label>
                            <select id="filter-cert" class="w-full border border-accent-100 rounded-xl px-3 py-2.5 text-sm bg-accent-50/30 hover:border-accent-300 focus:ring-2 focus:ring-accent-500 outline-none cursor-pointer transition"><option value="">æŒ‡å®šãªã—</option></select>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-success-600 block mb-1.5 ml-1 flex items-center gap-1"><span class="bg-success-100 p-1 rounded-md">â˜•</span> è¶£å‘³ãƒ»ãã®ä»–</label>
                            <select id="filter-hobby" class="w-full border border-success-100 rounded-xl px-3 py-2.5 text-sm bg-success-50/30 hover:border-success-300 focus:ring-2 focus:ring-success-500 outline-none cursor-pointer transition"><option value="">æŒ‡å®šãªã—</option></select>
                        </div>
                    </div>
                </div>

                <div class="mt-8 pt-4 border-t border-secondary-100 text-center">
                    <p class="text-xs text-secondary-400 mb-1">Matching Results</p>
                    <p class="text-2xl font-extrabold text-primary-600"><span id="count-display">0</span> <span class="text-sm font-medium text-secondary-400">users</span></p>
                </div>
            </div>
        </aside>

        <main class="lg:col-span-9">
            <div id="daily-pickup-container" class="mb-8 hidden animate-fade-in"></div>

            <div id="no-result" class="hidden h-80 flex flex-col items-center justify-center text-secondary-400 bg-white rounded-2xl border border-dashed border-secondary-300 shadow-sm">
                <div class="w-16 h-16 bg-secondary-100 rounded-full flex items-center justify-center mb-4 text-3xl">ğŸ¤”</div>
                <p class="font-medium">æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ç¤¾å“¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>
                <button onclick="resetFilter()" class="mt-4 px-6 py-2.5 bg-primary-50 text-primary-600 rounded-xl hover:bg-primary-100 transition text-sm font-bold">æ¤œç´¢æ¡ä»¶ã‚’ã‚¯ãƒªã‚¢</button>
            </div>

            <div id="user-list" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
        </main>
    </div>

    <script>
        const listContainer = document.getElementById('user-list');
        const countDisplay = document.getElementById('count-display');
        const noResultMsg = document.getElementById('no-result');
        const dailyPickupContainer = document.getElementById('daily-pickup-container');
        
        const inputSearch = document.getElementById('search-input');
        const selectDept = document.getElementById('filter-dept');
        const selectYear = document.getElementById('filter-year');
        const selectSkill = document.getElementById('filter-skill');
        const selectCert = document.getElementById('filter-cert');
        const selectHobby = document.getElementById('filter-hobby');

        function searchByTag(type, value) {
            resetFilter(false);
            if (type === 'skill') selectSkill.value = value;
            if (type === 'cert') selectCert.value = value;
            if (type === 'hobby') selectHobby.value = value;
            window.scrollTo({ top: 0, behavior: 'smooth' });
            filterUsers();
        }

        function initDailyPickup() {
            const today = new Date().toISOString().split('T')[0];
            let savedData = JSON.parse(localStorage.getItem('tf_daily_pickup'));
            let pickupUser;
            if (savedData && savedData.date === today) {
                pickupUser = users.find(u => u.id === savedData.userId);
            }
            if (!pickupUser) {
                pickupUser = users[Math.floor(Math.random() * users.length)];
                localStorage.setItem('tf_daily_pickup', JSON.stringify({ date: today, userId: pickupUser.id }));
            }
            if (!pickupUser) return;

            const html = `
                <div class="relative bg-gradient-to-r from-primary-600 to-purple-600 rounded-3xl p-6 md:p-8 text-white shadow-xl overflow-hidden group">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-16 -mt-16 blur-2xl group-hover:scale-110 transition duration-700"></div>
                    <div class="absolute bottom-0 left-0 w-48 h-48 bg-black/10 rounded-full -ml-10 -mb-10 blur-xl"></div>
                    <div class="relative z-10">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="bg-yellow-400 text-yellow-900 text-xs font-bold px-2 py-1 rounded shadow-sm flex items-center gap-1"><span>âœ¨</span> Today's Highlight</span>
                        </div>
                        <div class="flex flex-col md:flex-row gap-6 items-center md:items-start">
                            <div class="relative flex-shrink-0">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${pickupUser.id}&backgroundColor=b6e3f4" class="w-24 h-24 rounded-full border-4 border-white/30 shadow-md bg-white/20">
                            </div>
                            <div class="flex-1 text-center md:text-left">
                                <h3 class="text-2xl font-bold mb-1">${pickupUser.name}</h3>
                                <p class="text-primary-100 text-sm mb-3">${pickupUser.dept} / ${pickupUser.role}</p>
                                <div class="bg-white/10 backdrop-blur-sm rounded-xl p-3 border border-white/20 text-sm italic text-primary-50 mb-4 inline-block md:block">"${pickupUser.comment}"</div>
                            </div>
                            <div class="flex flex-col justify-center">
                                <a href="profile.html?id=${pickupUser.id}" class="bg-white text-primary-600 hover:bg-primary-50 font-bold py-3 px-6 rounded-xl shadow-lg transition transform hover:-translate-y-1 text-sm whitespace-nowrap">è©³ç´°ã‚’è¦‹ã‚‹</a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            dailyPickupContainer.innerHTML = html;
            dailyPickupContainer.classList.remove('hidden');
        }

        function initFilters() {
            const depts = [...new Set(users.map(u => u.dept))];
            depts.forEach(d => selectDept.add(new Option(d, d)));
            const years = [...new Set(users.map(u => { const match = u.role.match(/[0-9]{4}/); return match ? match[0] : null; }))].filter(y => y).sort().reverse();
            years.forEach(y => selectYear.add(new Option(y + "å¹´", y)));
            let allSkills = []; users.forEach(u => allSkills = allSkills.concat(u.skills));
            [...new Set(allSkills)].sort().forEach(s => selectSkill.add(new Option(s, s)));
            let allCerts = []; users.forEach(u => allCerts = allCerts.concat(u.certs));
            [...new Set(allCerts)].sort().forEach(c => selectCert.add(new Option(c, c)));
            let allHobbies = []; users.forEach(u => allHobbies = allHobbies.concat(u.hobbies));
            [...new Set(allHobbies)].sort().forEach(h => selectHobby.add(new Option(h, h)));

            const params = new URLSearchParams(window.location.search);
            const pSkill = params.get('skill');
            const pCert = params.get('cert');
            const pHobby = params.get('hobby');
            if (pSkill) selectSkill.value = pSkill;
            if (pCert) selectCert.value = pCert;
            if (pHobby) selectHobby.value = pHobby;
        }

        function renderUsers(list) {
            listContainer.innerHTML = '';
            countDisplay.innerText = list.length;
            if (list.length === 0) { noResultMsg.classList.remove('hidden'); return; }
            else { noResultMsg.classList.add('hidden'); }

            list.forEach((user, index) => {
                const delay = index < 12 ? `style="animation-delay: ${index * 50}ms"` : '';

                const skillsHtml = user.skills.slice(0, 2).map(tag => 
                    `<span onclick="event.preventDefault(); event.stopPropagation(); searchByTag('skill', '${tag}')" 
                           class="clickable-tag px-2 py-1 rounded-md text-[10px] font-semibold bg-primary-50 text-primary-700 border border-primary-100 hover:bg-primary-200 transition">
                       ${tag}
                     </span>`
                ).join('');
                
                const certsHtml = user.certs.length > 0 
                    ? `<div onclick="event.preventDefault(); event.stopPropagation(); searchByTag('cert', '${user.certs[0]}')" 
                            class="clickable-tag mt-2 flex items-center gap-1 text-[10px] font-medium text-accent-600 bg-accent-50 px-2 py-1 rounded-md border border-accent-100 w-fit max-w-full hover:bg-accent-200 transition">
                            <span class="flex-shrink-0">ğŸ…</span> <span class="truncate">${user.certs[0]}</span>
                       </div>` 
                    : '<div class="h-[26px] mt-2"></div>';

                const cardHtml = `
                    <div onclick="location.href='profile.html?id=${user.id}'" class="cursor-pointer group bg-white rounded-2xl p-5 shadow-[0_2px_8px_rgba(0,0,0,0.04)] hover:shadow-[0_12px_24px_rgba(0,0,0,0.08)] border border-secondary-100 hover:border-primary-200 transition-all duration-300 flex flex-col h-full relative overflow-hidden animate-fade-in" ${delay}>
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="relative">
                                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${user.id}&backgroundColor=b6e3f4" class="w-14 h-14 rounded-full border-2 border-white shadow-sm group-hover:scale-105 transition duration-300">
                                </div>
                                <div>
                                    <h3 class="font-bold text-secondary-800 text-lg leading-tight group-hover:text-primary-600 transition-colors">${user.name}</h3>
                                    <p class="text-xs text-secondary-500 font-medium mt-0.5">${user.dept}</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex-1">
                            <div class="mb-4">
                                <div class="flex flex-wrap gap-1.5 mb-1 h-7 overflow-hidden">${skillsHtml}</div>
                                ${certsHtml}
                            </div>
                            <div class="bg-secondary-50 rounded-xl p-3 relative">
                                <p class="text-xs text-secondary-600 italic line-clamp-2 px-2">${user.comment}</p>
                            </div>
                        </div>
                        <div class="mt-4 pt-3 border-t border-secondary-50 flex justify-between items-center">
                            <span class="text-[10px] text-secondary-400 font-medium">${user.role}</span>
                            <div class="w-8 h-8 rounded-full bg-secondary-50 flex items-center justify-center group-hover:bg-primary-600 group-hover:text-white transition-colors duration-300">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </div>
                        </div>
                    </div>
                `;
                listContainer.insertAdjacentHTML('beforeend', cardHtml);
            });
        }

        function filterUsers() {
            const keyword = inputSearch.value.toLowerCase();
            const deptVal = selectDept.value;
            const yearVal = selectYear.value;
            const skillVal = selectSkill.value;
            const certVal = selectCert.value;
            const hobbyVal = selectHobby.value;

            const filtered = users.filter(user => {
                const searchTarget = `${user.name} ${user.kana} ${user.hobbies.join(' ')} ${user.skills.join(' ')} ${user.certs.join(' ')} ${user.comment}`.toLowerCase();
                return searchTarget.includes(keyword) &&
                       (deptVal === "" || user.dept === deptVal) &&
                       (yearVal === "" || user.role.includes(yearVal)) &&
                       (skillVal === "" || user.skills.includes(skillVal)) &&
                       (certVal === "" || user.certs.includes(certVal)) &&
                       (hobbyVal === "" || user.hobbies.includes(hobbyVal));
            });
            renderUsers(filtered);
        }

        function resetFilter(shouldRender = true) {
            inputSearch.value = ''; selectDept.value = ''; selectYear.value = ''; 
            selectSkill.value = ''; selectCert.value = ''; selectHobby.value = '';
            if(shouldRender) filterUsers();
        }

        [inputSearch, selectDept, selectYear, selectSkill, selectCert, selectHobby].forEach(el => el.addEventListener(el.tagName==='INPUT'?'input':'change', filterUsers));

        initFilters();
        renderUsers(users); 
        filterUsers(); 
        initDailyPickup();
    </script>
</body>
</html>