<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾å†…æ²ç¤ºæ¿ | Talent Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="theme.js"></script>
    <script src="data.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-secondary-800 text-white border-b-4 border-secondary-600 sticky top-0 z-50 h-16 flex items-center px-6 justify-between shadow-lg">
        <div class="flex items-center gap-3 cursor-pointer group" onclick="resetFilter()">
            <div class="text-2xl rotate-12 group-hover:rotate-0 transition">ğŸ“Œ</div>
            <h1 class="font-bold text-xl tracking-widest" style="font-family: 'Zen Maru Gothic'">TALENT BOARD</h1>
        </div>
        <div class="flex items-center gap-4">
            <a href="mypage_edit.html" class="flex items-center gap-2 hover:bg-secondary-700 px-3 py-1.5 rounded-lg transition text-secondary-100">
                <span class="text-sm font-bold">è‡ªåˆ†ã®ã‚«ãƒ¼ãƒ‰</span>
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=MyIcon" class="rounded bg-secondary-50 w-8 h-8 border-2 border-secondary-400">
            </a>
        </div>
    </header>

    <div class="flex-1 max-w-7xl mx-auto w-full p-4 lg:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <aside class="lg:col-span-3 space-y-6">
            <div class="bg-yellow-50 p-6 rounded-sm shadow-floating transform -rotate-1 relative border-t-8 border-secondary-300 sticky top-24">
                <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 w-20 h-8 bg-gray-300 rounded-full shadow-md border-b-4 border-gray-400 z-10"></div>

                <div class="flex justify-between items-center mb-6 mt-2">
                    <h2 class="text-lg font-bold text-secondary-700 border-b-2 border-secondary-200 pb-1 w-full text-center">æ¤œç´¢ãƒ¡ãƒ¢</h2>
                </div>
                
                <div class="space-y-5">
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="åå‰ã‚„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰..." 
                            class="w-full bg-white border-b-2 border-secondary-200 px-2 py-3 text-sm focus:border-primary-500 outline-none transition placeholder-secondary-400 font-medium" style="background: repeating-linear-gradient(white, white 24px, #f1f5f9 25px);">
                    </div>

                    <div class="space-y-4 pt-2">
                        <div>
                            <label class="text-xs font-bold text-secondary-500 block mb-1">éƒ¨ç½²ã‚’é¸ã¶</label>
                            <select id="filter-dept" class="w-full bg-transparent border-2 border-dashed border-secondary-300 rounded px-2 py-2 text-sm cursor-pointer hover:bg-white transition"><option value="">å…¨ã¦ã®éƒ¨ç½²</option></select>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-secondary-500 block mb-1">å…¥ç¤¾å¹´</label>
                            <select id="filter-year" class="w-full bg-transparent border-2 border-dashed border-secondary-300 rounded px-2 py-2 text-sm cursor-pointer hover:bg-white transition"><option value="">å…¨ã¦ã®å¹´åº¦</option></select>
                        </div>
                    </div>

                    <div class="pt-4 border-t-2 border-secondary-200 border-dotted space-y-4">
                        <div>
                            <label class="text-xs font-bold text-primary-600 block mb-1">ã‚¹ã‚­ãƒ«</label>
                            <select id="filter-skill" class="w-full bg-primary-50 border border-primary-200 rounded px-2 py-2 text-sm cursor-pointer"><option value="">æŒ‡å®šãªã—</option></select>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-accent-600 block mb-1">è³‡æ ¼</label>
                            <select id="filter-cert" class="w-full bg-accent-50 border border-accent-200 rounded px-2 py-2 text-sm cursor-pointer"><option value="">æŒ‡å®šãªã—</option></select>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-success-600 block mb-1">è¶£å‘³</label>
                            <select id="filter-hobby" class="w-full bg-success-50 border border-success-200 rounded px-2 py-2 text-sm cursor-pointer"><option value="">æŒ‡å®šãªã—</option></select>
                        </div>
                    </div>

                    <div class="mt-6 text-center">
                        <button onclick="resetFilter()" class="text-xs text-secondary-500 underline hover:text-primary-500">æ¡ä»¶ã‚’æ¶ˆã—ã‚´ãƒ ã§æ¶ˆã™</button>
                        <p class="text-xl font-bold text-primary-600 mt-2 font-mono"><span id="count-display">0</span> <span class="text-sm text-secondary-400">æš</span></p>
                    </div>
                </div>
            </div>
        </aside>

        <main class="lg:col-span-9">
            
            <div id="daily-pickup-container" class="mb-10 hidden animate-fade-in flex justify-center">
                </div>

            <div id="no-result" class="hidden h-60 flex flex-col items-center justify-center text-secondary-500 bg-secondary-50/50 rounded border-2 border-dashed border-secondary-400">
                <div class="text-4xl mb-2 opacity-50">ğŸƒ</div>
                <p class="font-bold">æ²ç¤ºã‚«ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>
                <button onclick="resetFilter()" class="mt-4 px-4 py-2 bg-white border border-secondary-300 rounded shadow-sm hover:shadow text-sm text-primary-600">æœ€åˆã«æˆ»ã‚‹</button>
            </div>

            <div id="user-list" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8"></div>
        </main>
    </div>

    <script>
        const listContainer = document.getElementById('user-list');
        const countDisplay = document.getElementById('count-display');
        const noResultMsg = document.getElementById('no-result');
        const dailyPickupContainer = document.getElementById('daily-pickup-container');
        
        const inputSearch = document.getElementById('search-input');
        const selectDept = document.getElementById('filter-dept');
        const selectYear = document.getElementById('filter-year');
        const selectSkill = document.getElementById('filter-skill');
        const selectCert = document.getElementById('filter-cert');
        const selectHobby = document.getElementById('filter-hobby');

        function searchByTag(type, value) {
            resetFilter(false);
            if (type === 'skill') selectSkill.value = value;
            if (type === 'cert') selectCert.value = value;
            if (type === 'hobby') selectHobby.value = value;
            window.scrollTo({ top: 0, behavior: 'smooth' });
            filterUsers();
        }

        function initDailyPickup() {
            const today = new Date().toISOString().split('T')[0];
            let savedData = JSON.parse(localStorage.getItem('tf_daily_pickup'));
            let pickupUser;
            if (savedData && savedData.date === today) {
                pickupUser = users.find(u => u.id === savedData.userId);
            }
            if (!pickupUser) {
                pickupUser = users[Math.floor(Math.random() * users.length)];
                localStorage.setItem('tf_daily_pickup', JSON.stringify({ date: today, userId: pickupUser.id }));
            }
            if (!pickupUser) return;

            // ãƒãƒ©ãƒ­ã‚¤ãƒ‰é¢¨ãƒ‡ã‚¶ã‚¤ãƒ³
            const html = `
                <div class="relative bg-white p-4 pb-12 shadow-floating transform rotate-1 max-w-xl w-full">
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 w-32 h-8 bg-primary-100/50 rotate-1 tape"></div>
                    
                    <div class="flex items-center justify-center mb-2">
                        <span class="text-xs font-bold text-secondary-400 tracking-widest uppercase">Today's Pick Up</span>
                    </div>
                    
                    <div class="flex flex-col md:flex-row gap-6 items-center">
                        <div class="relative flex-shrink-0">
                            <div class="p-2 border border-secondary-100 shadow-inner bg-secondary-50">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${pickupUser.id}&backgroundColor=b6e3f4" class="w-32 h-32 object-cover">
                            </div>
                        </div>
                        <div class="flex-1 text-center md:text-left">
                            <h3 class="text-2xl font-bold text-secondary-800 mb-1" style="font-family: 'Zen Maru Gothic'">${pickupUser.name}</h3>
                            <p class="text-secondary-500 text-sm mb-4 border-b border-dashed border-secondary-300 pb-2 inline-block">${pickupUser.dept} / ${pickupUser.role}</p>
                            <div class="text-sm font-medium text-secondary-600 italic bg-yellow-50 p-3 rounded relative">
                                "${pickupUser.comment}"
                            </div>
                            <div class="mt-4 flex justify-center md:justify-start">
                                <a href="profile.html?id=${pickupUser.id}" class="text-sm font-bold text-primary-600 border-b-2 border-primary-300 hover:border-primary-600 transition">ã‚‚ã£ã¨è©³ã—ãè¦‹ã‚‹ â†’</a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            dailyPickupContainer.innerHTML = html;
            dailyPickupContainer.classList.remove('hidden');
        }

        function initFilters() {
            const depts = [...new Set(users.map(u => u.dept))];
            depts.forEach(d => selectDept.add(new Option(d, d)));
            const years = [...new Set(users.map(u => { const match = u.role.match(/[0-9]{4}/); return match ? match[0] : null; }))].filter(y => y).sort().reverse();
            years.forEach(y => selectYear.add(new Option(y + "å¹´", y)));
            let allSkills = []; users.forEach(u => allSkills = allSkills.concat(u.skills));
            [...new Set(allSkills)].sort().forEach(s => selectSkill.add(new Option(s, s)));
            let allCerts = []; users.forEach(u => allCerts = allCerts.concat(u.certs));
            [...new Set(allCerts)].sort().forEach(c => selectCert.add(new Option(c, c)));
            let allHobbies = []; users.forEach(u => allHobbies = allHobbies.concat(u.hobbies));
            [...new Set(allHobbies)].sort().forEach(h => selectHobby.add(new Option(h, h)));

            const params = new URLSearchParams(window.location.search);
            const pSkill = params.get('skill'); const pCert = params.get('cert'); const pHobby = params.get('hobby');
            if (pSkill) selectSkill.value = pSkill; if (pCert) selectCert.value = pCert; if (pHobby) selectHobby.value = pHobby;
        }

        function renderUsers(list) {
            listContainer.innerHTML = '';
            countDisplay.innerText = list.length;
            if (list.length === 0) { noResultMsg.classList.remove('hidden'); return; }
            else { noResultMsg.classList.add('hidden'); }

            list.forEach((user, index) => {
                const delay = index < 12 ? `style="animation-delay: ${index * 50}ms"` : '';
                // ã‚«ãƒ¼ãƒ‰ã®è§’åº¦ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«å°‘ã—å‚¾ã‘ã‚‹ï¼ˆæ‰‹è²¼ã‚Šæ„Ÿï¼‰
                const rotate = (Math.random() * 2 - 1).toFixed(1); 

                const skillsHtml = user.skills.slice(0, 2).map(tag => 
                    `<span onclick="event.preventDefault(); event.stopPropagation(); searchByTag('skill', '${tag}')" 
                           class="clickable-tag px-2 py-0.5 rounded text-[10px] font-bold bg-primary-50 text-primary-700 border border-primary-100 hover:bg-primary-100 transition">
                       ${tag}
                     </span>`
                ).join('');
                
                const certsHtml = user.certs.length > 0 
                    ? `<div onclick="event.preventDefault(); event.stopPropagation(); searchByTag('cert', '${user.certs[0]}')" 
                            class="clickable-tag mt-2 inline-flex items-center gap-1 text-[10px] font-bold text-white bg-accent-400 px-2 py-0.5 shadow-sm transform -rotate-1 hover:rotate-0 transition">
                            <span>â˜…</span> <span class="truncate max-w-[120px]">${user.certs[0]}</span>
                       </div>` 
                    : '<div class="h-[26px] mt-2"></div>';

                // ãƒ”ãƒ³ç•™ã‚ã‚«ãƒ¼ãƒ‰é¢¨ãƒ‡ã‚¶ã‚¤ãƒ³
                const cardHtml = `
                    <div onclick="location.href='profile.html?id=${user.id}'" 
                         class="cursor-pointer group bg-white p-5 shadow-paper hover:shadow-floating transition-all duration-300 flex flex-col h-full relative animate-fade-in" 
                         style="transform: rotate(${rotate}deg); animation-delay: ${index * 50}ms">
                        
                        <div class="pin-tack"></div>

                        <div class="flex items-start justify-between mb-3 pt-2">
                            <div class="flex items-center gap-3">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${user.id}&backgroundColor=b6e3f4" class="w-12 h-12 rounded bg-secondary-50 border border-secondary-200 shadow-sm">
                                <div>
                                    <h3 class="font-bold text-secondary-800 text-lg leading-tight group-hover:text-primary-600 transition-colors" style="font-family: 'Zen Maru Gothic'">${user.name}</h3>
                                    <p class="text-xs text-secondary-500 font-bold mt-0.5 border-b border-secondary-200 inline-block">${user.dept}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex-1">
                            <div class="mb-3">
                                <div class="flex flex-wrap gap-1 mb-1 h-6 overflow-hidden">${skillsHtml}</div>
                                ${certsHtml}
                            </div>
                            <div class="bg-secondary-50/50 p-2 rounded border-l-4 border-secondary-300">
                                <p class="text-xs text-secondary-600 font-medium line-clamp-2">"${user.comment}"</p>
                            </div>
                        </div>
                        
                        <div class="mt-3 pt-2 border-t-2 border-dotted border-secondary-200 flex justify-between items-center">
                            <span class="text-[10px] text-secondary-400 font-bold uppercase tracking-wider">${user.role}</span>
                            <span class="text-secondary-300 group-hover:text-primary-500 transition">ğŸ‘‰</span>
                        </div>
                    </div>
                `;
                listContainer.insertAdjacentHTML('beforeend', cardHtml);
            });
        }

        function filterUsers() {
            const keyword = inputSearch.value.toLowerCase();
            const deptVal = selectDept.value; const yearVal = selectYear.value;
            const skillVal = selectSkill.value; const certVal = selectCert.value; const hobbyVal = selectHobby.value;

            const filtered = users.filter(user => {
                const searchTarget = `${user.name} ${user.kana} ${user.hobbies.join(' ')} ${user.skills.join(' ')} ${user.certs.join(' ')} ${user.comment}`.toLowerCase();
                return searchTarget.includes(keyword) &&
                       (deptVal === "" || user.dept === deptVal) &&
                       (yearVal === "" || user.role.includes(yearVal)) &&
                       (skillVal === "" || user.skills.includes(skillVal)) &&
                       (certVal === "" || user.certs.includes(certVal)) &&
                       (hobbyVal === "" || user.hobbies.includes(hobbyVal));
            });
            renderUsers(filtered);
        }

        function resetFilter(shouldRender = true) {
            inputSearch.value = ''; selectDept.value = ''; selectYear.value = ''; 
            selectSkill.value = ''; selectCert.value = ''; selectHobby.value = '';
            if(shouldRender) filterUsers();
        }

        [inputSearch, selectDept, selectYear, selectSkill, selectCert, selectHobby].forEach(el => el.addEventListener(el.tagName==='INPUT'?'input':'change', filterUsers));

        initFilters(); renderUsers(users); filterUsers(); initDailyPickup();
    </script>
</body>
</html>