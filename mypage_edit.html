<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªåˆ†ã®ã‚«ãƒ¼ãƒ‰ã‚’ç·¨é›†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="theme.js"></script>
    <script src="data.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-secondary-50 min-h-screen pb-20">

    <header class="bg-secondary-800 text-white border-b-4 border-secondary-600 sticky top-0 z-50 h-16 flex items-center px-6 justify-between shadow-lg">
        <div class="flex items-center gap-3">
            <h1 class="font-bold text-xl tracking-widest" style="font-family: 'Zen Maru Gothic'">MY CARD EDIT</h1>
        </div>
        <div class="flex items-center gap-4">
            <button onclick="confirmBack()" class="px-4 py-2 bg-transparent border border-white/30 text-white rounded font-bold hover:bg-white/10 transition shadow-sm text-sm flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                æˆ»ã‚‹
            </button>
        </div>
    </header>

    <div class="w-[96%] max-w-[1800px] mx-auto p-4 lg:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <aside class="lg:col-span-4 hidden lg:block">
            <div class="sticky top-24">
                <div class="flex items-center gap-2 mb-4">
                    <span class="text-2xl">ğŸ‘€</span>
                    <h2 class="font-bold text-secondary-700">è‡ªå·±ç´¹ä»‹ã‚«ãƒ¼ãƒ‰ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰</h2>
                </div>
                
                <div class="bg-white p-6 shadow-floating transform rotate-1 relative border-t-8 border-primary-400 rounded-sm">
                    <div class="pin-tack"></div>
                    <div class="flex items-start justify-between mb-4 pt-2">
                        <div class="flex items-center gap-4">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=MyIcon" class="w-16 h-16 rounded bg-secondary-50 border border-secondary-200 shadow-sm">
                            <div>
                                <h3 class="font-bold text-secondary-800 text-2xl" id="preview-name">å±±ç”° å¤ªéƒ</h3>
                                <p class="text-sm text-secondary-500 font-bold mt-1 border-b border-secondary-200 inline-block" id="preview-dept">BIäº‹æ¥­éƒ¨</p>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <p class="text-[10px] text-secondary-400 font-bold mb-1">SKILLS</p>
                            <div class="flex flex-wrap gap-1" id="preview-skills"></div>
                        </div>
                        <div id="preview-certs-container" class="hidden">
                             <p class="text-[10px] text-secondary-400 font-bold mb-1">LICENSE</p>
                             <div class="flex flex-wrap gap-1" id="preview-certs"></div>
                        </div>
                        <div class="bg-secondary-50/50 p-3 rounded border-l-4 border-secondary-300">
                            <p class="text-sm text-secondary-600 font-medium italic" id="preview-comment">"ã“ã“ã«ã²ã¨ã“ã¨ãŒå…¥ã‚Šã¾ã™"</p>
                        </div>
                        <div class="pt-3 border-t border-dashed border-secondary-200 space-y-3">
                            <div>
                                <span class="text-[10px] bg-primary-100 text-primary-700 px-2 py-0.5 rounded font-bold">Q. ä»•äº‹ã®æµå„€</span>
                                <p class="text-xs text-secondary-700 font-medium mt-1 pl-1 border-l-2 border-primary-200" id="preview-q1">...</p>
                            </div>
                            <div>
                                <span class="text-[10px] bg-accent-100 text-accent-800 px-2 py-0.5 rounded font-bold">Q. æœ€è¿‘ã®ãƒã‚¤ãƒ–ãƒ¼ãƒ </span>
                                <p class="text-xs text-secondary-700 font-medium mt-1 pl-1 border-l-2 border-accent-200" id="preview-q2">...</p>
                            </div>
                            <div>
                                <span class="text-[10px] bg-success-100 text-success-700 px-2 py-0.5 rounded font-bold">Q. å®Ÿã¯ç§...</span>
                                <p class="text-xs text-secondary-700 font-medium mt-1 pl-1 border-l-2 border-success-200" id="preview-q3">...</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center pt-2 border-t border-dotted border-secondary-200">
                             <span class="text-xs text-secondary-400 font-bold uppercase tracking-wider" id="preview-role">2020å¹´å…¥ç¤¾</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <main class="lg:col-span-8">
            <div class="bg-white p-8 rounded shadow-sm border border-secondary-200">
                <h2 class="text-xl font-bold text-secondary-700 mb-6 border-b-2 border-secondary-100 pb-2 flex items-center gap-2">
                    <span>âœï¸</span> æƒ…å ±ã‚’å…¥åŠ›
                </h2>

                <form class="space-y-8" onsubmit="return false;" id="edit-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-secondary-600 mb-2">åå‰</label>
                            <input type="text" value="å±±ç”° å¤ªéƒ" class="w-full border-2 border-secondary-200 rounded p-3 focus:border-primary-500 focus:bg-primary-50/20 outline-none transition font-bold" oninput="updatePreview('name', this.value)">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-secondary-600 mb-2">ãƒ•ãƒªã‚¬ãƒŠ</label>
                            <input type="text" value="ãƒ¤ãƒãƒ€ ã‚¿ãƒ­ã‚¦" class="w-full border-2 border-secondary-200 rounded p-3 focus:border-primary-500 outline-none transition">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-secondary-600 mb-2">éƒ¨ç½²</label>
                            <select id="input-dept" class="w-full border-2 border-secondary-200 rounded p-3 focus:border-primary-500 outline-none transition cursor-pointer" onchange="updatePreview('dept', this.value)">
                                </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-secondary-600 mb-2">å…¥ç¤¾å¹´åº¦</label>
                            <select id="input-year" class="w-full border-2 border-secondary-200 rounded p-3 focus:border-primary-500 outline-none transition cursor-pointer" onchange="updatePreview('role', this.value + 'å…¥ç¤¾')">
                                </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-secondary-600 mb-2">ã²ã¨ã“ã¨ã‚³ãƒ¡ãƒ³ãƒˆ (ä»Šã®æ°—æŒã¡)</label>
                        <input type="text" value="æ–°ã—ã„æŠ€è¡“ã«æŒ‘æˆ¦ä¸­ã§ã™ï¼" class="w-full border-2 border-secondary-200 rounded p-3 focus:border-primary-500 outline-none transition" oninput="updatePreview('comment', this.value)">
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-secondary-600 mb-2">å¾—æ„ãªã‚¹ã‚­ãƒ«</label>
                        <div id="selected-skills-container" class="flex flex-wrap gap-2 mb-2 min-h-[30px]"></div>
                        
                        <div class="relative">
                            <input type="text" id="skill-search" placeholder="ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä¸€è¦§ã‚’è¡¨ç¤ºã€ã¾ãŸã¯å…¥åŠ›ã—ã¦æ¤œç´¢..." class="w-full border-2 border-secondary-200 rounded p-3 focus:border-primary-500 outline-none transition cursor-pointer">
                            <ul id="skill-results" class="hidden absolute z-10 w-full bg-white border-2 border-secondary-200 rounded mt-1 max-h-60 overflow-y-auto shadow-lg">
                                </ul>
                        </div>
                        <p class="text-xs text-secondary-400 mt-1">â€»ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨å…¨ãƒªã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-secondary-600 mb-2">ä¿æœ‰è³‡æ ¼ (å¥¨åŠ±è³‡æ ¼ãƒªã‚¹ãƒˆ)</label>
                        <div id="selected-certs-container" class="flex flex-wrap gap-2 mb-2 min-h-[30px]"></div>
                        
                        <div class="relative">
                            <input type="text" id="cert-search" placeholder="ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä¸€è¦§ã‚’è¡¨ç¤ºã€ã¾ãŸã¯å…¥åŠ›ã—ã¦æ¤œç´¢..." class="w-full border-2 border-secondary-200 rounded p-3 focus:border-primary-500 outline-none transition cursor-pointer">
                            <ul id="cert-results" class="hidden absolute z-10 w-full bg-white border-2 border-secondary-200 rounded mt-1 max-h-60 overflow-y-auto shadow-lg">
                                </ul>
                        </div>
                         <p class="text-xs text-secondary-400 mt-1">â€»ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨å…¨ãƒªã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>

                    <div class="bg-secondary-50 p-6 rounded border-2 border-dashed border-secondary-200 space-y-6">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-xl">ğŸ¤</span>
                            <h3 class="font-bold text-secondary-700">3ã¤ã®è³ªå•ã§è‡ªå·±ç´¹ä»‹</h3>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-primary-700 mb-2">Q1. ä»•äº‹ã§å¤§åˆ‡ã«ã—ã¦ã„ã‚‹ã“ã¨ï¼ˆæµå„€ï¼‰</label>
                            <input type="text" class="w-full border-2 border-secondary-200 rounded p-3 focus:border-primary-500 outline-none transition" 
                                placeholder="ä¾‹ï¼šã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿã€ç›¸æ‰‹ã®ç«‹å ´ã«ç«‹ã¤..." value="ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦–ç‚¹ã§ã®é–‹ç™ºã‚’å¿ƒãŒã‘ã¦ã„ã¾ã™ã€‚" oninput="updatePreview('q1', this.value)">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-accent-700 mb-2">Q2. æœ€è¿‘ã®ãƒã‚¤ãƒ–ãƒ¼ãƒ ãƒ»ãƒãƒã£ã¦ã„ã‚‹ã“ã¨</label>
                            <input type="text" class="w-full border-2 border-secondary-200 rounded p-3 focus:border-accent-500 outline-none transition" 
                                placeholder="ä¾‹ï¼šã‚µã‚¦ãƒŠã€éŸ“å›½ãƒ‰ãƒ©ãƒã€ã‚­ãƒ£ãƒ³ãƒ—..." value="é€±æœ«ã®ã‚­ãƒ£ãƒ³ãƒ—ã¨ç„šãç«å‹•ç”»ã‚’è¦‹ã‚‹ã“ã¨ã€‚" oninput="updatePreview('q2', this.value)">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-success-700 mb-2">Q3. å®Ÿã¯ç§...ï¼ˆæ„å¤–ãªä¸€é¢ã‚„ç‰¹æŠ€ï¼‰</label>
                            <input type="text" class="w-full border-2 border-secondary-200 rounded p-3 focus:border-success-500 outline-none transition" 
                                placeholder="ä¾‹ï¼šæ˜”ãƒãƒ³ãƒ‰ã‚„ã£ã¦ã¾ã—ãŸã€å®Ÿã¯ç”˜å…šã§ã™..." value="å­¦ç”Ÿæ™‚ä»£ã¯ç¾è¡“éƒ¨ã§æ²¹çµµã‚’æã„ã¦ã„ã¾ã—ãŸã€‚" oninput="updatePreview('q3', this.value)">
                        </div>
                    </div>

                    <div class="pt-6 border-t border-secondary-100 flex justify-end gap-4">
                        <button type="button" onclick="confirmBack()" class="px-6 py-3 rounded text-secondary-500 font-bold hover:bg-secondary-50 transition">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        <button type="button" class="px-8 py-3 bg-primary-600 text-white rounded font-bold shadow hover:bg-primary-700 hover:shadow-lg transition transform hover:-translate-y-0.5" onclick="saveAndExit()">
                            ä¿å­˜ã™ã‚‹
                        </button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script>
        let mySkills = ["Python", "JavaScript", "ãƒ‡ã‚¶ã‚¤ãƒ³"]; 
        let myCerts = []; 
        let isDirty = false;

        function markAsDirty() { isDirty = true; }

        function confirmBack() {
            if (isDirty) {
                if (confirm("å¤‰æ›´å†…å®¹ã¯ä¿å­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nä¿å­˜ã›ãšã«å‰ã®ç”»é¢ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ")) {
                    location.href = 'dashboard.html';
                }
            } else {
                location.href = 'dashboard.html';
            }
        }

        function saveAndExit() {
            alert('ä¿å­˜ã—ã¾ã—ãŸï¼');
            isDirty = false; 
        }

        function updatePreview(id, value) {
            const el = document.getElementById('preview-' + id);
            if(el) el.innerText = value || "...";
            markAsDirty();
        }

        function renderSkills() {
            const container = document.getElementById('selected-skills-container');
            const previewContainer = document.getElementById('preview-skills');
            container.innerHTML = '';
            previewContainer.innerHTML = '';

            mySkills.forEach((skill, index) => {
                const tag = document.createElement('span');
                tag.className = 'px-3 py-1 rounded bg-primary-50 text-primary-700 font-bold text-sm border border-primary-100 flex items-center gap-2';
                tag.innerHTML = `${skill} <button onclick="removeSkill(${index})" class="text-primary-400 hover:text-primary-600">Ã—</button>`;
                container.appendChild(tag);

                const pTag = document.createElement('span');
                pTag.className = 'px-2 py-0.5 rounded text-[10px] font-bold bg-primary-50 text-primary-700 border border-primary-100';
                pTag.innerText = skill;
                previewContainer.appendChild(pTag);
            });
        }
        function addSkill(skill) {
            if (skill && !mySkills.includes(skill)) {
                mySkills.push(skill);
                renderSkills();
                markAsDirty();
            }
        }
        function removeSkill(index) {
            mySkills.splice(index, 1);
            renderSkills();
            markAsDirty();
        }

        function renderCerts() {
            const container = document.getElementById('selected-certs-container');
            const previewContainer = document.getElementById('preview-certs');
            const previewWrapper = document.getElementById('preview-certs-container');
            
            container.innerHTML = '';
            previewContainer.innerHTML = '';

            if(myCerts.length > 0) {
                previewWrapper.classList.remove('hidden');
            } else {
                previewWrapper.classList.add('hidden');
            }

            myCerts.forEach((cert, index) => {
                const tag = document.createElement('span');
                tag.className = 'px-3 py-1 rounded bg-accent-50 text-secondary-700 font-bold text-sm border border-accent-200 flex items-center gap-2';
                tag.innerHTML = `â˜… ${cert} <button onclick="removeCert(${index})" class="text-secondary-400 hover:text-red-500">Ã—</button>`;
                container.appendChild(tag);

                const pTag = document.createElement('span');
                pTag.className = 'px-2 py-0.5 rounded text-[10px] font-bold bg-accent-100 text-secondary-800 border border-accent-200';
                pTag.innerText = `â˜… ${cert}`;
                previewContainer.appendChild(pTag);
            });
        }
        function addCert(cert) {
            if (cert && !myCerts.includes(cert)) {
                myCerts.push(cert);
                renderCerts();
                markAsDirty();
            }
        }
        function removeCert(index) {
            myCerts.splice(index, 1);
            renderCerts();
            markAsDirty();
        }

        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('edit-form');
            form.addEventListener('input', markAsDirty);
            form.addEventListener('change', markAsDirty);

            // éƒ¨ç½²ãƒªã‚¹ãƒˆ
            const depts = [...new Set(users.map(u => u.dept))];
            const deptSelect = document.getElementById('input-dept');
            depts.forEach(d => {
                const opt = new Option(d, d);
                if (d === "BIäº‹æ¥­éƒ¨") opt.selected = true; 
                deptSelect.add(opt);
            });
            updatePreview('dept', deptSelect.value);

            // å…¥ç¤¾å¹´åº¦
            const yearSelect = document.getElementById('input-year');
            const currentYear = new Date().getFullYear();
            for (let y = currentYear; y >= 2000; y--) {
                const val = `${y}å¹´`;
                const opt = new Option(val, val);
                if (y === 2020) opt.selected = true; 
                yearSelect.add(opt);
            }
            updatePreview('role', yearSelect.value + 'å…¥ç¤¾');

            // --- ã‚¹ã‚­ãƒ«æ¤œç´¢æ©Ÿèƒ½ ---
            const allSkills = [...new Set(users.flatMap(u => u.skills))].sort((a, b) => a.localeCompare(b, 'ja'));
            const skillInput = document.getElementById('skill-search');
            const skillResults = document.getElementById('skill-results');

            function updateSkillList(filterText) {
                skillResults.innerHTML = '';
                const val = filterText ? filterText.toLowerCase() : '';
                
                let matches = val ? allSkills.filter(s => s.toLowerCase().includes(val)) : allSkills;

                if (matches.length > 0) {
                    skillResults.classList.remove('hidden');
                    matches.forEach(match => {
                        const li = document.createElement('li');
                        li.className = "px-3 py-2 hover:bg-secondary-50 cursor-pointer text-sm font-bold text-secondary-700 border-b border-gray-100 last:border-0";
                        li.innerText = match;
                        li.onmousedown = (e) => { 
                             e.preventDefault(); 
                             addSkill(match);
                             skillInput.value = '';
                             skillResults.classList.add('hidden');
                        };
                        skillResults.appendChild(li);
                    });
                } else {
                    const li = document.createElement('li');
                    li.className = "px-3 py-2 text-sm text-gray-400";
                    li.innerText = "è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
                    skillResults.appendChild(li);
                    skillResults.classList.remove('hidden');
                }
            }
            skillInput.addEventListener('input', (e) => updateSkillList(e.target.value));
            skillInput.addEventListener('focus', (e) => updateSkillList(e.target.value));
            skillInput.addEventListener('blur', () => setTimeout(() => skillResults.classList.add('hidden'), 200));

            // --- è³‡æ ¼æ¤œç´¢æ©Ÿèƒ½ ---
            const certInput = document.getElementById('cert-search');
            const certResults = document.getElementById('cert-results');

            function updateCertList(filterText) {
                certResults.innerHTML = '';
                const val = filterText ? filterText.toLowerCase() : '';
                
                let matches = val ? officialCerts.filter(c => c.toLowerCase().includes(val)) : officialCerts;

                if (matches.length > 0) {
                    certResults.classList.remove('hidden');
                    matches.forEach(match => {
                        const li = document.createElement('li');
                        li.className = "px-3 py-2 hover:bg-secondary-50 cursor-pointer text-sm font-bold text-secondary-700 border-b border-gray-100 last:border-0";
                        li.innerText = match;
                        li.onmousedown = (e) => { 
                             e.preventDefault(); 
                             addCert(match);
                             certInput.value = '';
                             certResults.classList.add('hidden');
                        };
                        certResults.appendChild(li);
                    });
                } else {
                    const li = document.createElement('li');
                    li.className = "px-3 py-2 text-sm text-gray-400";
                    li.innerText = "è©²å½“ãªã—";
                    certResults.appendChild(li);
                    certResults.classList.remove('hidden');
                }
            }
            certInput.addEventListener('input', (e) => updateCertList(e.target.value));
            certInput.addEventListener('focus', (e) => updateCertList(e.target.value));
            certInput.addEventListener('blur', () => setTimeout(() => certResults.classList.add('hidden'), 200));

            updatePreview('q1', "ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦–ç‚¹ã§ã®é–‹ç™ºã‚’å¿ƒãŒã‘ã¦ã„ã¾ã™ã€‚");
            updatePreview('q2', "é€±æœ«ã®ã‚­ãƒ£ãƒ³ãƒ—ã¨ç„šãç«å‹•ç”»ã‚’è¦‹ã‚‹ã“ã¨ã€‚");
            updatePreview('q3', "å­¦ç”Ÿæ™‚ä»£ã¯ç¾è¡“éƒ¨ã§æ²¹çµµã‚’æã„ã¦ã„ã¾ã—ãŸã€‚");
            renderSkills();
            renderCerts();
            isDirty = false; 
        });
    </script>
</body>
</html>